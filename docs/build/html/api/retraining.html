

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>retraining &mdash; documentación de Sistema de Riesgo Crediticio con RBM - 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=36c4ab74"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=f85f4cfb"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Referencia de la API" href="../api_reference.html" />
    <link rel="prev" title="educational_rag" href="educational_rag.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Sistema de Riesgo Crediticio con RBM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">Manual de Usuario</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Módulos del Sistema</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../modules.html#modulos-principales">Módulos Principales</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../modules.html#referencia-completa-de-la-api">Referencia Completa de la API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="generar_datos.html">generar_datos</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_processor.html">data_processor</a></li>
<li class="toctree-l3"><a class="reference internal" href="univariate_analysis.html">univariate_analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="bivariate_analysis.html">bivariate_analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="feature_engineering.html">feature_engineering</a></li>
<li class="toctree-l3"><a class="reference internal" href="clustering.html">clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="rbm_model.html">rbm_model</a></li>
<li class="toctree-l3"><a class="reference internal" href="supervised_models.html">supervised_models</a></li>
<li class="toctree-l3"><a class="reference internal" href="prediction.html">prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="educational_rag.html">educational_rag</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">retraining</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#descripcion-general">Descripción General</a></li>
<li class="toctree-l4"><a class="reference internal" href="#clases-principales">Clases Principales</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metodos-de-gestion">Métodos de Gestión</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metodos-de-deteccion-de-drift">Métodos de Detección de Drift</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metodos-de-versionado">Métodos de Versionado</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metodos-de-re-entrenamiento">Métodos de Re-entrenamiento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#funciones-de-renderizado">Funciones de Renderizado</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests-estadisticos">Tests Estadísticos</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejemplo-completo-de-re-entrenamiento">Ejemplo Completo de Re-entrenamiento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#workflow-de-re-entrenamiento">Workflow de Re-entrenamiento</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gestion-de-versiones">Gestión de Versiones</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoreo-de-drift">Monitoreo de Drift</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ejemplo-de-pipeline-completo">Ejemplo de Pipeline Completo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mejores-practicas">Mejores Prácticas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ver-tambien">Ver también</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html#arquitectura-del-sistema">Arquitectura del Sistema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html#flujo-de-datos">Flujo de Datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html#descripcion-de-modulos">Descripción de Módulos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html#configuracion-avanzada">Configuración Avanzada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html#integracion-con-otros-sistemas">Integración con Otros Sistemas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">Referencia de la API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sistema de Riesgo Crediticio con RBM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../modules.html">Módulos del Sistema</a></li>
      <li class="breadcrumb-item active">retraining</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/retraining.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="retraining">
<h1>retraining<a class="headerlink" href="#retraining" title="Link to this heading"></a></h1>
<section id="descripcion-general">
<h2>Descripción General<a class="headerlink" href="#descripcion-general" title="Link to this heading"></a></h2>
<p>Sistema de re-entrenamiento automático de modelos con detección de data drift, versionado de modelos y comparación de rendimiento.</p>
</section>
<section id="clases-principales">
<h2>Clases Principales<a class="headerlink" href="#clases-principales" title="Link to this heading"></a></h2>
<section id="modelretrainer">
<h3>ModelRetrainer<a class="headerlink" href="#modelretrainer" title="Link to this heading"></a></h3>
</section>
</section>
<section id="metodos-de-gestion">
<h2>Métodos de Gestión<a class="headerlink" href="#metodos-de-gestion" title="Link to this heading"></a></h2>
<section id="get-available-models">
<h3>get_available_models<a class="headerlink" href="#get-available-models" title="Link to this heading"></a></h3>
<p>Obtiene lista de modelos disponibles para re-entrenamiento.</p>
<dl class="simple">
<dt><strong>Returns:</strong></dt><dd><p>Lista de claves de modelos</p>
</dd>
</dl>
<p><strong>Ejemplo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">get_available_models</span><span class="p">()</span>

<span class="k">for</span> <span class="n">model_key</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">model_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-model-info">
<h3>load_model_info<a class="headerlink" href="#load-model-info" title="Link to this heading"></a></h3>
<p>Carga información completa del modelo.</p>
<dl class="simple">
<dt><strong>Parameters:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_key</span></code> (str): Clave del modelo</p></li>
</ul>
</dd>
<dt><strong>Returns:</strong></dt><dd><p>Diccionario con información del modelo</p>
</dd>
<dt><strong>Información incluida:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_data</span></code>: Datos del modelo (pickle)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code>: Fecha de entrenamiento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature_names</span></code>: Características usadas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metrics</span></code>: Métricas de evaluación</p></li>
</ul>
</dd>
</dl>
<p><strong>Ejemplo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">info</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">load_model_info</span><span class="p">(</span><span class="s1">&#39;random_forest&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestamp: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Características: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="metodos-de-deteccion-de-drift">
<h2>Métodos de Detección de Drift<a class="headerlink" href="#metodos-de-deteccion-de-drift" title="Link to this heading"></a></h2>
<section id="detect-data-drift">
<h3>detect_data_drift<a class="headerlink" href="#detect-data-drift" title="Link to this heading"></a></h3>
<p>Detecta data drift entre datasets usando tests estadísticos.</p>
<dl class="simple">
<dt><strong>Parameters:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">original_data</span></code> (DataFrame): Dataset original</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data</span></code> (DataFrame): Dataset nuevo</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature_names</span></code> (List[str]): Características a comparar</p></li>
</ul>
</dd>
<dt><strong>Returns:</strong></dt><dd><p>Diccionario con resultados del análisis</p>
</dd>
</dl>
<p><strong>Tests estadísticos aplicados:</strong></p>
<ol class="arabic simple">
<li><p><strong>Kolmogorov-Smirnov (KS):</strong> Compara distribuciones completas</p></li>
<li><p><strong>Mann-Whitney U:</strong> Compara medianas</p></li>
<li><p><strong>Diferencia de medias:</strong> Cambio en tendencia central</p></li>
<li><p><strong>Diferencia de desviaciones:</strong> Cambio en dispersión</p></li>
</ol>
<dl class="simple">
<dt><strong>Criterio de drift:</strong></dt><dd><ul class="simple">
<li><p>p-value &lt; 0.05 en KS o Mann-Whitney</p></li>
<li><p>Indica cambio significativo en la distribución</p></li>
</ul>
</dd>
</dl>
<p><strong>Ejemplo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cargar datos</span>
<span class="n">df_original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;datos_2023.csv&quot;</span><span class="p">)</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;datos_2024.csv&quot;</span><span class="p">)</span>

<span class="c1"># Detectar drift</span>
<span class="n">drift_results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">detect_data_drift</span><span class="p">(</span>
    <span class="n">df_original</span><span class="p">,</span>
    <span class="n">df_new</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">,</span> <span class="s1">&#39;salario_mensual&#39;</span><span class="p">,</span> <span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">,</span> <span class="s1">&#39;dti&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Analizar resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Características con drift: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">]:</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;drift_scores&#39;</span><span class="p">][</span><span class="n">feature</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  KS p-value: </span><span class="si">{</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;ks_pvalue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Diferencia media: </span><span class="si">{</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;mean_diff&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Diferencia std: </span><span class="si">{</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;std_diff&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Decisión</span>
<span class="n">drift_percentage</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="k">if</span> <span class="n">drift_percentage</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ RECOMENDACIÓN: Re-entrenar modelo (&gt;30</span><span class="si">% c</span><span class="s2">aracterísticas con drift)&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">drift_percentage</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">💡 RECOMENDACIÓN: Considerar re-entrenamiento (10-30</span><span class="si">% d</span><span class="s2">rift)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ RECOMENDACIÓN: Modelo actual es adecuado (&lt;10</span><span class="si">% d</span><span class="s2">rift)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="metodos-de-versionado">
<h2>Métodos de Versionado<a class="headerlink" href="#metodos-de-versionado" title="Link to this heading"></a></h2>
<section id="create-version-backup">
<h3>create_version_backup<a class="headerlink" href="#create-version-backup" title="Link to this heading"></a></h3>
<p>Crea backup versionado del modelo actual.</p>
<dl class="simple">
<dt><strong>Parameters:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_key</span></code> (str): Clave del modelo</p></li>
</ul>
</dd>
<dt><strong>Returns:</strong></dt><dd><p>Nombre de la versión creada</p>
</dd>
<dt><strong>Formato de versión:</strong></dt><dd><p><code class="docutils literal notranslate"><span class="pre">{model_key}_v{YYYYMMDD_HHMMSS}</span></code></p>
</dd>
<dt><strong>Archivos guardados:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{version_name}_model.pkl</span></code>: Modelo completo</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{version_name}_metrics.json</span></code>: Métricas de evaluación</p></li>
</ul>
</dd>
</dl>
<p><strong>Ejemplo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear backup antes de re-entrenar</span>
<span class="n">version_name</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">create_version_backup</span><span class="p">(</span><span class="s1">&#39;xgboost&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Backup creado: </span><span class="si">{</span><span class="n">version_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Ubicación: models/versions/</span><span class="si">{</span><span class="n">version_name</span><span class="si">}</span><span class="s2">_model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Ahora es seguro re-entrenar</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">retrain_model</span><span class="p">(</span><span class="s1">&#39;xgboost&#39;</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="metodos-de-re-entrenamiento">
<h2>Métodos de Re-entrenamiento<a class="headerlink" href="#metodos-de-re-entrenamiento" title="Link to this heading"></a></h2>
<section id="retrain-model">
<h3>retrain_model<a class="headerlink" href="#retrain-model" title="Link to this heading"></a></h3>
<p>Re-entrena un modelo con nuevos datos.</p>
<dl class="simple">
<dt><strong>Parameters:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_key</span></code> (str): Clave del modelo a re-entrenar</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data</span></code> (DataFrame): Nuevos datos para entrenamiento</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_col</span></code> (str): Variable objetivo (default: “nivel_riesgo”)</p></li>
</ul>
</dd>
<dt><strong>Returns:</strong></dt><dd><p>Diccionario con resultados del re-entrenamiento</p>
</dd>
</dl>
<p><strong>Proceso:</strong></p>
<ol class="arabic simple">
<li><p>Crear instancia de SupervisedModelTrainer</p></li>
<li><p>Preparar nuevos datos (70/20/10 split)</p></li>
<li><p>Re-entrenar con GridSearchCV</p></li>
<li><p>Calcular métricas completas</p></li>
<li><p>Guardar modelo actualizado</p></li>
<li><p>Retornar resultados</p></li>
</ol>
<p><strong>Ejemplo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cargar nuevos datos</span>
<span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;datos_nuevos_2024.csv&quot;</span><span class="p">)</span>

<span class="c1"># Re-entrenar</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">retrain_model</span><span class="p">(</span>
    <span class="n">model_key</span><span class="o">=</span><span class="s1">&#39;xgboost&#39;</span><span class="p">,</span>
    <span class="n">new_data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;nivel_riesgo&#39;</span>
<span class="p">)</span>

<span class="c1"># Ver resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo re-entrenado exitosamente&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nuevas métricas:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Accuracy: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  F1-Score: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ROC-AUC: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Mejores parámetros encontrados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mejores hiperparámetros:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;best_params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="funciones-de-renderizado">
<h2>Funciones de Renderizado<a class="headerlink" href="#funciones-de-renderizado" title="Link to this heading"></a></h2>
<section id="render-retraining-module">
<h3>render_retraining_module<a class="headerlink" href="#render-retraining-module" title="Link to this heading"></a></h3>
<p>Renderiza el módulo completo de re-entrenamiento en Streamlit.</p>
<p><strong>Funcionalidades:</strong></p>
<ol class="arabic simple">
<li><p><strong>Selección de modelo:</strong></p>
<ul class="simple">
<li><p>Lista de modelos disponibles</p></li>
<li><p>Métricas actuales</p></li>
<li><p>Fecha de última actualización</p></li>
</ul>
</li>
<li><p><strong>Carga de datos:</strong></p>
<ul class="simple">
<li><p>Usar datos existentes</p></li>
<li><p>Cargar archivo nuevo (CSV/Excel)</p></li>
<li><p>Vista previa de datos</p></li>
</ul>
</li>
<li><p><strong>Detección de drift:</strong></p>
<ul class="simple">
<li><p>Tests estadísticos (KS, Mann-Whitney)</p></li>
<li><p>Visualización de características con drift</p></li>
<li><p>Recomendaciones automáticas</p></li>
</ul>
</li>
<li><p><strong>Re-entrenamiento:</strong></p>
<ul class="simple">
<li><p>Opción de crear backup</p></li>
<li><p>Optimización de hiperparámetros</p></li>
<li><p>Comparación de rendimiento</p></li>
<li><p>Gráficos comparativos</p></li>
</ul>
</li>
<li><p><strong>Gestión de versiones:</strong></p>
<ul class="simple">
<li><p>Lista de versiones guardadas</p></li>
<li><p>Restauración de versiones anteriores</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="tests-estadisticos">
<h2>Tests Estadísticos<a class="headerlink" href="#tests-estadisticos" title="Link to this heading"></a></h2>
<section id="test-de-kolmogorov-smirnov">
<h3>Test de Kolmogorov-Smirnov<a class="headerlink" href="#test-de-kolmogorov-smirnov" title="Link to this heading"></a></h3>
<p>Compara dos distribuciones empíricas.</p>
<p><strong>Hipótesis nula:</strong> Las dos muestras provienen de la misma distribución</p>
<div class="math notranslate nohighlight">
\[D = \max_x |F_1(x) - F_2(x)|\]</div>
<ul class="simple">
<li><p><strong>p-value &lt; 0.05:</strong> Rechazar H₀ (hay drift)</p></li>
<li><p><strong>p-value ≥ 0.05:</strong> No rechazar H₀ (sin drift)</p></li>
</ul>
</section>
<section id="test-de-mann-whitney-u">
<h3>Test de Mann-Whitney U<a class="headerlink" href="#test-de-mann-whitney-u" title="Link to this heading"></a></h3>
<p>Compara medianas de dos grupos independientes.</p>
<p><strong>Hipótesis nula:</strong> Las medianas son iguales</p>
<ul class="simple">
<li><p><strong>p-value &lt; 0.05:</strong> Medianas diferentes (hay drift)</p></li>
<li><p><strong>p-value ≥ 0.05:</strong> Medianas similares (sin drift)</p></li>
</ul>
</section>
</section>
<section id="ejemplo-completo-de-re-entrenamiento">
<h2>Ejemplo Completo de Re-entrenamiento<a class="headerlink" href="#ejemplo-completo-de-re-entrenamiento" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.retraining</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelRetrainer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Inicializar</span>
<span class="n">retrainer</span> <span class="o">=</span> <span class="n">ModelRetrainer</span><span class="p">()</span>

<span class="c1"># Paso 1: Cargar modelo actual</span>
<span class="n">model_key</span> <span class="o">=</span> <span class="s1">&#39;xgboost&#39;</span>
<span class="n">model_info</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">load_model_info</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo actual: </span><span class="si">{</span><span class="n">model_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fecha: </span><span class="si">{</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Paso 2: Cargar datos</span>
<span class="n">df_original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/processed/datos_credito_hipotecario_realista.csv&quot;</span><span class="p">)</span>
<span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/new/datos_nuevos_2024.csv&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Datos originales: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_original</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datos nuevos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_new</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>

<span class="c1"># Paso 3: Detectar drift</span>
<span class="n">drift_results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">detect_data_drift</span><span class="p">(</span>
    <span class="n">df_original</span><span class="p">,</span>
    <span class="n">df_new</span><span class="p">,</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">n_drift</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">])</span>
<span class="n">total_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">])</span>
<span class="n">drift_pct</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_drift</span> <span class="o">/</span> <span class="n">total_features</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Análisis de Drift:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Características con drift: </span><span class="si">{</span><span class="n">n_drift</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_features</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">drift_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Características afectadas:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;drift_scores&#39;</span><span class="p">][</span><span class="n">feature</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">: KS p-value=</span><span class="si">{</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;ks_pvalue&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Paso 4: Decidir si re-entrenar</span>
<span class="n">should_retrain</span> <span class="o">=</span> <span class="n">drift_pct</span> <span class="o">&gt;</span> <span class="mi">20</span>  <span class="c1"># Umbral: 20%</span>

<span class="k">if</span> <span class="n">should_retrain</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ Se recomienda re-entrenar (drift &gt; 20%)&quot;</span><span class="p">)</span>

    <span class="c1"># Paso 5: Crear backup</span>
    <span class="n">version_name</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">create_version_backup</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Backup creado: </span><span class="si">{</span><span class="n">version_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Paso 6: Re-entrenar</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔄 Re-entrenando modelo...&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">retrain_model</span><span class="p">(</span><span class="n">model_key</span><span class="p">,</span> <span class="n">df_new</span><span class="p">)</span>

    <span class="c1"># Paso 7: Comparar rendimiento</span>
    <span class="n">old_accuracy</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="n">new_accuracy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="n">improvement</span> <span class="o">=</span> <span class="n">new_accuracy</span> <span class="o">-</span> <span class="n">old_accuracy</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 Comparación de Rendimiento:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Accuracy anterior: </span><span class="si">{</span><span class="n">old_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Accuracy nueva: </span><span class="si">{</span><span class="n">new_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mejora: </span><span class="si">{</span><span class="n">improvement</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">improvement</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ Modelo mejorado significativamente&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">improvement</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ Modelo empeoró - considerar restaurar backup&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">➖ Rendimiento similar&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ No se requiere re-entrenamiento (drift &lt; 20%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="workflow-de-re-entrenamiento">
<h2>Workflow de Re-entrenamiento<a class="headerlink" href="#workflow-de-re-entrenamiento" title="Link to this heading"></a></h2>
<section id="flujo-recomendado">
<h3>Flujo Recomendado<a class="headerlink" href="#flujo-recomendado" title="Link to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>1. Cargar modelo actual
   ↓
2. Cargar nuevos datos
   ↓
3. Detectar data drift
   ↓
4. ¿Drift &gt; 20%? ──No──→ Mantener modelo actual
   │
   Sí
   ↓
5. Crear backup versionado
   ↓
6. Re-entrenar modelo
   ↓
7. Comparar rendimiento
   ↓
8. ¿Mejora &gt; 1%? ──No──→ Restaurar backup
   │
   Sí
   ↓
9. Usar nuevo modelo
</pre></div>
</div>
</section>
<section id="criterios-de-re-entrenamiento">
<h3>Criterios de Re-entrenamiento<a class="headerlink" href="#criterios-de-re-entrenamiento" title="Link to this heading"></a></h3>
<p><strong>Cuándo re-entrenar:</strong></p>
<ul class="simple">
<li><p>Drift &gt; 20% de características</p></li>
<li><p>Degradación de métricas en producción</p></li>
<li><p>Nuevos datos disponibles (&gt;1000 registros)</p></li>
<li><p>Cambios en el negocio o regulaciones</p></li>
<li><p>Periodicidad: Cada 3-6 meses</p></li>
</ul>
<p><strong>Cuándo NO re-entrenar:</strong></p>
<ul class="simple">
<li><p>Drift &lt; 10% de características</p></li>
<li><p>Pocos datos nuevos (&lt;500 registros)</p></li>
<li><p>Modelo funcionando bien en producción</p></li>
<li><p>Cambios recientes (&lt; 1 mes)</p></li>
</ul>
</section>
</section>
<section id="gestion-de-versiones">
<h2>Gestión de Versiones<a class="headerlink" href="#gestion-de-versiones" title="Link to this heading"></a></h2>
<section id="estructura-de-versiones">
<h3>Estructura de Versiones<a class="headerlink" href="#estructura-de-versiones" title="Link to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>models/
├── supervised/           # Modelos activos
│   ├── xgboost_model.pkl
│   ├── xgboost_metrics.json
│   └── ...
└── versions/            # Versiones históricas
    ├── xgboost_v20240115_143022_model.pkl
    ├── xgboost_v20240115_143022_metrics.json
    ├── xgboost_v20240220_091545_model.pkl
    └── ...
</pre></div>
</div>
</section>
<section id="restaurar-version-anterior">
<h3>Restaurar Versión Anterior<a class="headerlink" href="#restaurar-version-anterior" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Listar versiones disponibles</span>
<span class="n">versions_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;models/versions&quot;</span><span class="p">)</span>
<span class="n">version_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">versions_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;xgboost_v*_model.pkl&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Versiones disponibles:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">version_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">version_files</span><span class="p">):</span>
    <span class="n">version_name</span> <span class="o">=</span> <span class="n">version_file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_model&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">version_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Restaurar versión específica</span>
<span class="n">version_to_restore</span> <span class="o">=</span> <span class="n">version_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Más reciente</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span>
    <span class="n">version_to_restore</span><span class="p">,</span>
    <span class="s2">&quot;models/supervised/xgboost_model.pkl&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Versión restaurada: </span><span class="si">{</span><span class="n">version_to_restore</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="monitoreo-de-drift">
<h2>Monitoreo de Drift<a class="headerlink" href="#monitoreo-de-drift" title="Link to this heading"></a></h2>
<section id="metricas-de-drift">
<h3>Métricas de Drift<a class="headerlink" href="#metricas-de-drift" title="Link to this heading"></a></h3>
<p>Para cada característica se calcula:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Métrica</p></th>
<th class="head"><p>Descripción</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>KS Statistic</p></td>
<td><p>Máxima diferencia entre CDFs</p></td>
</tr>
<tr class="row-odd"><td><p>KS p-value</p></td>
<td><p>Significancia estadística</p></td>
</tr>
<tr class="row-even"><td><p>MW p-value</p></td>
<td><p>Test de Mann-Whitney</p></td>
</tr>
<tr class="row-odd"><td><p>Mean Diff</p></td>
<td><p>|media_nueva - media_original|</p></td>
</tr>
<tr class="row-even"><td><p>Std Diff</p></td>
<td><p>|std_nueva - std_original|</p></td>
</tr>
</tbody>
</table>
</section>
<section id="visualizacion-de-drift">
<h3>Visualización de Drift<a class="headerlink" href="#visualizacion-de-drift" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>

<span class="c1"># Crear gráfico de drift</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;drift_scores&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">ks_pvalues</span> <span class="o">=</span> <span class="p">[</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;drift_scores&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">][</span><span class="s1">&#39;ks_pvalue&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">ks_pvalues</span><span class="p">,</span>
    <span class="n">marker_color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s1">&#39;green&#39;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ks_pvalues</span><span class="p">]</span>
<span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
              <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Umbral de significancia&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Data Drift por Característica&quot;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Características&quot;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;KS p-value&quot;</span><span class="p">,</span>
    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;plotly_white&quot;</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="ejemplo-de-pipeline-completo">
<h2>Ejemplo de Pipeline Completo<a class="headerlink" href="#ejemplo-de-pipeline-completo" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.retraining</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelRetrainer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.supervised_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">SupervisedModelTrainer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">automated_retraining_pipeline</span><span class="p">(</span><span class="n">model_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pipeline automatizado de re-entrenamiento&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIPELINE DE RE-ENTRENAMIENTO AUTOMÁTICO&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo: </span><span class="si">{</span><span class="n">model_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fecha: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Inicializar</span>
    <span class="n">retrainer</span> <span class="o">=</span> <span class="n">ModelRetrainer</span><span class="p">()</span>

    <span class="c1"># 1. Cargar modelo actual</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1/7] Cargando modelo actual...&quot;</span><span class="p">)</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">load_model_info</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>
    <span class="n">current_accuracy</span> <span class="o">=</span> <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Accuracy actual: </span><span class="si">{</span><span class="n">current_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. Cargar datos</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2/7] Cargando datos...&quot;</span><span class="p">)</span>
    <span class="n">df_original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/processed/datos_credito_hipotecario_realista.csv&quot;</span><span class="p">)</span>
    <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">new_data_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Original: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_original</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Nuevo: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_new</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Detectar drift</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[3/7] Detectando data drift...&quot;</span><span class="p">)</span>
    <span class="n">drift_results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">detect_data_drift</span><span class="p">(</span>
        <span class="n">df_original</span><span class="p">,</span>
        <span class="n">df_new</span><span class="p">,</span>
        <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">n_drift</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">drift_results</span><span class="p">[</span><span class="s1">&#39;features_with_drift&#39;</span><span class="p">])</span>
    <span class="n">drift_pct</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_drift</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Drift detectado: </span><span class="si">{</span><span class="n">n_drift</span><span class="si">}</span><span class="s2"> características (</span><span class="si">{</span><span class="n">drift_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="c1"># 4. Decidir si re-entrenar</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[4/7] Evaluando necesidad de re-entrenamiento...&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">drift_pct</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ✅ Drift bajo (</span><span class="si">{</span><span class="n">drift_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%) - No se requiere re-entrenamiento&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;skipped&#39;</span><span class="p">,</span> <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;low_drift&#39;</span><span class="p">,</span> <span class="s1">&#39;drift_pct&#39;</span><span class="p">:</span> <span class="n">drift_pct</span><span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ⚠️ Drift significativo (</span><span class="si">{</span><span class="n">drift_pct</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%) - Procediendo con re-entrenamiento&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Crear backup</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[5/7] Creando backup...&quot;</span><span class="p">)</span>
    <span class="n">version_name</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">create_version_backup</span><span class="p">(</span><span class="n">model_key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ✅ Backup: </span><span class="si">{</span><span class="n">version_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 6. Re-entrenar</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[6/7] Re-entrenando modelo...&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">retrainer</span><span class="o">.</span><span class="n">retrain_model</span><span class="p">(</span><span class="n">model_key</span><span class="p">,</span> <span class="n">df_new</span><span class="p">)</span>
    <span class="n">new_accuracy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">][</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
    <span class="n">improvement</span> <span class="o">=</span> <span class="n">new_accuracy</span> <span class="o">-</span> <span class="n">current_accuracy</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Nueva accuracy: </span><span class="si">{</span><span class="n">new_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">improvement</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># 7. Validar mejora</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[7/7] Validando mejora...&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">improvement</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ✅ Mejora significativa - Modelo actualizado&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span>
    <span class="k">elif</span> <span class="n">improvement</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ❌ Degradación detectada - Restaurando backup&quot;</span><span class="p">)</span>
        <span class="c1"># Restaurar backup aquí</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;degraded&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      ➖ Rendimiento similar - Modelo actualizado&quot;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;similar&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PIPELINE COMPLETADO&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
        <span class="s1">&#39;drift_pct&#39;</span><span class="p">:</span> <span class="n">drift_pct</span><span class="p">,</span>
        <span class="s1">&#39;old_accuracy&#39;</span><span class="p">:</span> <span class="n">current_accuracy</span><span class="p">,</span>
        <span class="s1">&#39;new_accuracy&#39;</span><span class="p">:</span> <span class="n">new_accuracy</span><span class="p">,</span>
        <span class="s1">&#39;improvement&#39;</span><span class="p">:</span> <span class="n">improvement</span><span class="p">,</span>
        <span class="s1">&#39;version_backup&#39;</span><span class="p">:</span> <span class="n">version_name</span>
    <span class="p">}</span>

<span class="c1"># Ejecutar pipeline</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">automated_retraining_pipeline</span><span class="p">(</span>
    <span class="n">model_key</span><span class="o">=</span><span class="s1">&#39;xgboost&#39;</span><span class="p">,</span>
    <span class="n">new_data_path</span><span class="o">=</span><span class="s1">&#39;data/new/datos_2024_q1.csv&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resultado final: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mejores-practicas">
<h2>Mejores Prácticas<a class="headerlink" href="#mejores-practicas" title="Link to this heading"></a></h2>
<section id="frecuencia-de-re-entrenamiento">
<h3>Frecuencia de Re-entrenamiento<a class="headerlink" href="#frecuencia-de-re-entrenamiento" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Mensual:</strong> Si hay flujo constante de datos nuevos</p></li>
<li><p><strong>Trimestral:</strong> Para la mayoría de casos</p></li>
<li><p><strong>Semestral:</strong> Si los datos son estables</p></li>
<li><p><strong>Ad-hoc:</strong> Cuando se detecta degradación</p></li>
</ul>
</section>
<section id="validacion-post-reentrenamiento">
<h3>Validación Post-Reentrenamiento<a class="headerlink" href="#validacion-post-reentrenamiento" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Comparar métricas:</strong> Accuracy, F1, ROC-AUC</p></li>
<li><p><strong>Validar en holdout:</strong> Datos no vistos</p></li>
<li><p><strong>A/B testing:</strong> Comparar en producción</p></li>
<li><p><strong>Monitorear predicciones:</strong> Primeras semanas</p></li>
</ol>
</section>
<section id="id1">
<h3>Gestión de Versiones<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Mantener últimas 10 versiones</p></li>
<li><p>Documentar cambios en cada versión</p></li>
<li><p>Etiquetar versiones en producción</p></li>
<li><p>Backup antes de cada re-entrenamiento</p></li>
</ul>
</section>
</section>
<section id="ver-tambien">
<h2>Ver también<a class="headerlink" href="#ver-tambien" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="supervised_models.html"><span class="doc">supervised_models</span></a> - Entrenamiento de modelos</p></li>
<li><p><a class="reference internal" href="prediction.html"><span class="doc">prediction</span></a> - Sistema de predicción</p></li>
<li><p><a class="reference internal" href="data_processor.html"><span class="doc">data_processor</span></a> - Procesamiento de datos</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="educational_rag.html" class="btn btn-neutral float-left" title="educational_rag" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../api_reference.html" class="btn btn-neutral float-right" title="Referencia de la API" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2025, Andrés Fernando Gómez Rojas &amp; Carlos Andrés Gómez Vasco. Software Libre bajo Licencia MIT.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>