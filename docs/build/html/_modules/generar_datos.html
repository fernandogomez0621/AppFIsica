

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>generar_datos &mdash; documentación de Sistema de Riesgo Crediticio con RBM - 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=36c4ab74"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=f85f4cfb"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Sistema de Riesgo Crediticio con RBM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">Manual de Usuario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Módulos del Sistema</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">Referencia de la API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sistema de Riesgo Crediticio con RBM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Código de módulo</a></li>
      <li class="breadcrumb-item active">generar_datos</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Código fuente para generar_datos</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GENERADOR DE DATOS SINTÉTICOS DE CRÉDITO HIPOTECARIO - COLOMBIA</span>
<span class="sd">Versión: 1.3 - REALISTA CORREGIDA</span>
<span class="sd">Autor: Sistema de Riesgo Crediticio</span>
<span class="sd">Fecha: 2024</span>

<span class="sd">CORRECCIONES REALISTAS IMPLEMENTADAS:</span>
<span class="sd">1. Distribución realista de riesgo: 60% Bajo, 25% Medio, 15% Alto</span>
<span class="sd">2. Correlaciones más suaves y creíbles</span>
<span class="sd">3. Capacidad residual 100% positiva</span>
<span class="sd">4. Impacto realista de demandas en puntaje</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GeneradorCreditoHipotecarioRealista</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generador de datos sintéticos de crédito hipotecario para Colombia</span>
<span class="sd">    con distribución REALISTA de riesgo y correlaciones creíbles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_registros</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">semilla</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa el generador con parámetros realistas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n_registros</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">=</span> <span class="n">semilla</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">semilla</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_configuracion_realista</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Generador REALISTA inicializado para </span><span class="si">{</span><span class="n">n_registros</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Semilla base: </span><span class="si">{</span><span class="n">semilla</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Objetivo riesgo: 60% Bajo, 25% Medio, 15% Alto&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_configuracion_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuración con parámetros REALISTAS&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ciudades</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Bogotá&quot;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span> <span class="s2">&quot;Medellín&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;Cali&quot;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span> <span class="s2">&quot;Barranquilla&quot;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span>
            <span class="s2">&quot;Cartagena&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;Bucaramanga&quot;</span><span class="p">:</span> <span class="mf">0.04</span><span class="p">,</span> <span class="s2">&quot;Pereira&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span> <span class="s2">&quot;Cúcuta&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>
            <span class="s2">&quot;Manizales&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;Santa Marta&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;Ibagué&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s2">&quot;Villavicencio&quot;</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span>
            <span class="s2">&quot;Pasto&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;Montería&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;Otras&quot;</span><span class="p">:</span> <span class="mf">0.02</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Bogotá&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
            <span class="s2">&quot;Medellín&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
            <span class="s2">&quot;Cali&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span>
            <span class="s2">&quot;Barranquilla&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span>
            <span class="s2">&quot;grande&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span>
            <span class="s2">&quot;intermedia&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span>
            <span class="s2">&quot;pequeña&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicador_salario_ciudad</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Bogotá&quot;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s2">&quot;Medellín&quot;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span> <span class="s2">&quot;Cali&quot;</span><span class="p">:</span> <span class="mf">1.00</span><span class="p">,</span> <span class="s2">&quot;Barranquilla&quot;</span><span class="p">:</span> <span class="mf">0.98</span><span class="p">,</span>
            <span class="s2">&quot;Cartagena&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s2">&quot;Bucaramanga&quot;</span><span class="p">:</span> <span class="mf">0.92</span><span class="p">,</span> <span class="s2">&quot;Pereira&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s2">&quot;Cúcuta&quot;</span><span class="p">:</span> <span class="mf">0.88</span><span class="p">,</span>
            <span class="s2">&quot;Manizales&quot;</span><span class="p">:</span> <span class="mf">0.88</span><span class="p">,</span> <span class="s2">&quot;Santa Marta&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span> <span class="s2">&quot;Ibagué&quot;</span><span class="p">:</span> <span class="mf">0.88</span><span class="p">,</span> <span class="s2">&quot;Villavicencio&quot;</span><span class="p">:</span> <span class="mf">0.87</span><span class="p">,</span>
            <span class="s2">&quot;Pasto&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s2">&quot;Montería&quot;</span><span class="p">:</span> <span class="mf">0.83</span><span class="p">,</span> <span class="s2">&quot;Otras&quot;</span><span class="p">:</span> <span class="mf">0.80</span>
        <span class="p">}</span>
        
        <span class="c1"># SALARIOS MÁS REALISTAS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salario_base_educacion</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Bachiller&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1800000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">1200000</span><span class="p">,</span> <span class="mi">3500000</span><span class="p">),</span>  <span class="c1"># Reducidos</span>
            <span class="s2">&quot;Técnico&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2800000</span><span class="p">,</span> <span class="mi">700000</span><span class="p">,</span> <span class="mi">1800000</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">),</span>
            <span class="s2">&quot;Profesional&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4500000</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">,</span> <span class="mi">3000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">),</span>
            <span class="s2">&quot;Posgrado&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8000000</span><span class="p">,</span> <span class="mi">3000000</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">,</span> <span class="mi">20000000</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1"># VALORES DE INMUEBLES MÁS CONSERVADORES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valores_inmuebles</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Bogotá&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="p">(</span><span class="mi">550</span><span class="p">,</span> <span class="mi">900</span><span class="p">)],</span>
            <span class="s2">&quot;Medellín&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">85</span><span class="p">),</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span> <span class="p">(</span><span class="mi">450</span><span class="p">,</span> <span class="mi">800</span><span class="p">)],</span>
            <span class="s2">&quot;Cali&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">650</span><span class="p">)],</span>
            <span class="s2">&quot;Barranquilla&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">600</span><span class="p">)],</span>
            <span class="s2">&quot;grande&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span> <span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mi">600</span><span class="p">)],</span>
            <span class="s2">&quot;intermedia&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">55</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">110</span><span class="p">),</span> <span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">160</span><span class="p">),</span> <span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="p">(</span><span class="mi">280</span><span class="p">,</span> <span class="mi">450</span><span class="p">)],</span>
            <span class="s2">&quot;pequeña&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">65</span><span class="p">),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">350</span><span class="p">)]</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">generar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Genera el dataset completo con distribución REALISTA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INICIANDO GENERACIÓN DE DATOS SINTÉTICOS - VERSIÓN REALISTA&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
        
        <span class="n">fases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Generando variables demográficas...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_demografica</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Generando variables laborales...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_laboral</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Generando variables financieras...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_financiera</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Generando variables del crédito...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_credito</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Generando características derivadas...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_caracteristicas</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Calculando nivel de riesgo REALISTA...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fase_riesgo_realista</span><span class="p">)</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">mensaje</span><span class="p">,</span> <span class="n">metodo</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fases</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[FASE </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/6] </span><span class="si">{</span><span class="n">mensaje</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">metodo</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Fase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> completada&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[VALIDACIÓN] Ejecutando validaciones REALISTAS...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validar_restricciones_realistas</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Validaciones completadas&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓✓✓ GENERACIÓN COMPLETADA: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_demografica</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 1: Variables demográficas&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span><span class="p">)</span>
        <span class="c1"># Edad más realista</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">),</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="n">ciudades</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ciudades</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ciudades</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ciudad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">ciudades</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_estrato</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_educacion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_estado_civil</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_personas_a_cargo</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_laboral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 2: Variables laborales&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_tipo_empleo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_antiguedad_laboral</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_salario_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_egresos_realistas</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_financiera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 3: Variables financieras&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_demandas_realistas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_puntaje_datacredito_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_propiedades</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_patrimonio_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_saldo_banco_realista</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_credito</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 4: Variables del crédito - VERSIÓN REALISTA&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_valor_inmueble_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_anos_inmueble</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_cuota_inicial_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_monto_credito</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_plazo_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_tasa_interes_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_cuota_mensual_realista</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_caracteristicas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 5: Características derivadas&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generar_caracteristicas_derivadas</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_fase_riesgo_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fase 6: Nivel de riesgo REALISTA&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_nivel_riesgo_realista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ajustar_capacidad_residual_positiva</span><span class="p">()</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># MÉTODOS REALISTAS CORREGIDOS</span>
    <span class="c1"># ========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_salario_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera salario mensual con rangos más realistas&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">800</span><span class="p">)</span>
        <span class="n">salarios</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">educacion</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nivel_educacion&#39;</span><span class="p">]</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span>
            <span class="n">ciudad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ciudad&#39;</span><span class="p">]</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            
            <span class="n">media</span><span class="p">,</span> <span class="n">sd</span><span class="p">,</span> <span class="n">minimo</span><span class="p">,</span> <span class="n">maximo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salario_base_educacion</span><span class="p">[</span><span class="n">educacion</span><span class="p">]</span>
            
            <span class="c1"># Distribución más realista (menos extrema)</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">media</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">)</span>
            
            <span class="n">factor_antiguedad</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">antiguedad</span><span class="p">),</span> <span class="mf">1.50</span><span class="p">)</span>  <span class="c1"># Más conservador</span>
            <span class="n">salario</span> <span class="o">*=</span> <span class="n">factor_antiguedad</span>
            
            <span class="n">factor_ciudad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicador_salario_ciudad</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ciudad</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">)</span>
            <span class="n">salario</span> <span class="o">*=</span> <span class="n">factor_ciudad</span>
            
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">*=</span> <span class="mf">1.00</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">*=</span> <span class="mf">1.05</span>  <span class="c1"># Menos ventaja</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">*=</span> <span class="mf">0.80</span>  <span class="c1"># Menos penalización</span>
            
            <span class="n">salario</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minimo</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="n">maximo</span><span class="p">))</span>
            
            <span class="c1"># Estratos más realistas</span>
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">,</span> <span class="mi">2200000</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">,</span> <span class="mi">3500000</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">2000000</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">3500000</span><span class="p">,</span> <span class="mi">9000000</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">,</span> <span class="mi">15000000</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">salario</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">salario</span><span class="p">,</span> <span class="mi">8000000</span><span class="p">,</span> <span class="mi">25000000</span><span class="p">)</span>
            
            <span class="n">salario</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>  <span class="c1"># Menos variación</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">salario</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
            
            <span class="n">salarios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">salario</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">salarios</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_egresos_realistas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera egresos mensuales que garantizan capacidad residual positiva&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">900</span><span class="p">)</span>
        <span class="n">egresos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            <span class="n">personas</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;personas_a_cargo&#39;</span><span class="p">]</span>
            
            <span class="c1"># GARANTIZAR MARGEN PARA CUOTA HIPOTECARIA</span>
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Estratos bajos gastan más porcentaje pero menos absoluto</span>
                <span class="n">factor_gastos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">factor_gastos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factor_gastos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">)</span>
            
            <span class="n">egreso_base</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="n">factor_gastos</span>
            
            <span class="c1"># Gastos por personas (más conservador)</span>
            <span class="n">gastos_personas</span> <span class="o">=</span> <span class="n">personas</span> <span class="o">*</span> <span class="mi">250000</span>  <span class="c1"># Reducido</span>
            
            <span class="n">egreso_total</span> <span class="o">=</span> <span class="n">egreso_base</span> <span class="o">+</span> <span class="n">gastos_personas</span>
            
            <span class="c1"># GARANTIZAR MÍNIMO DEL 25% DE CAPACIDAD DE AHORRO</span>
            <span class="n">egreso_maximo</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="mf">0.75</span>
            <span class="n">egreso_total</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">egreso_total</span><span class="p">,</span> <span class="n">egreso_maximo</span><span class="p">)</span>
            
            <span class="c1"># GARANTIZAR GASTOS MÍNIMOS REALISTAS</span>
            <span class="n">egreso_minimo</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="mf">0.40</span>
            <span class="n">egreso_total</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">egreso_total</span><span class="p">,</span> <span class="n">egreso_minimo</span><span class="p">)</span>
            
            <span class="n">egreso_total</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">egreso_total</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">egresos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">egreso_total</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">egresos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_demandas_realistas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera número de demandas legales con distribución realista&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">demandas</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            
            <span class="c1"># DISTRIBUCIÓN REALISTA: mayoría sin demandas</span>
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Informal&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>  <span class="c1"># 80% sin demandas</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>  <span class="c1"># 92% sin demandas</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Independiente</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>  <span class="c1"># 85% sin demandas</span>
            
            <span class="n">num_demandas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">demandas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_demandas</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;numero_demandas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demandas</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_puntaje_datacredito_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;PUNTAJE DATACRÉDITO CON CORRELACIÓN MÁS REALISTA CON DEMANDAS&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1100</span><span class="p">)</span>
        <span class="n">puntajes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">demandas</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;numero_demandas&#39;</span><span class="p">]</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            <span class="n">educacion</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nivel_educacion&#39;</span><span class="p">]</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span>
            <span class="n">egresos</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span>
            
            <span class="c1"># BASE MÁS ALTA - mayoría tiene buen historial</span>
            <span class="n">puntaje</span> <span class="o">=</span> <span class="mi">720</span>  <span class="c1"># Base realista (antes 650)</span>
            
            <span class="c1"># IMPACTO MÁS SUAVE DE DEMANDAS (CORRELACIÓN REALISTA)</span>
            <span class="k">if</span> <span class="n">demandas</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">demandas</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">40</span>  <span class="c1"># Antes -150! (mucho más suave)</span>
            <span class="k">elif</span> <span class="n">demandas</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">90</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">150</span>
            
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">15</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="mi">25</span> <span class="o">&lt;=</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="mi">35</span> <span class="o">&lt;=</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">55</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">30</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="k">if</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">2000000</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">4000000</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">8000000</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">25</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">40</span>
            
            <span class="n">ratio_gastos</span> <span class="o">=</span> <span class="n">egresos</span> <span class="o">/</span> <span class="n">salario</span>
            <span class="k">if</span> <span class="n">ratio_gastos</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">ratio_gastos</span> <span class="o">&gt;</span> <span class="mf">0.70</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">10</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">15</span>
            
            <span class="k">if</span> <span class="n">antiguedad</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">25</span>
            <span class="k">elif</span> <span class="n">antiguedad</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">15</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">-=</span> <span class="mi">5</span>
            
            <span class="k">if</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Posgrado&quot;</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">30</span>
            <span class="k">elif</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Profesional&quot;</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Técnico&quot;</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="c1"># VARIACIÓN NATURAL MÁS PEQUEÑA</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            
            <span class="c1"># RANGOS MÁS REALISTAS</span>
            <span class="k">if</span> <span class="n">demandas</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">puntaje</span><span class="p">,</span> <span class="mi">650</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Informal&quot;</span> <span class="ow">and</span> <span class="n">demandas</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">puntaje</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">puntaje</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
            
            <span class="n">puntaje</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">puntaje</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">850</span><span class="p">))</span>  <span class="c1"># Rango más realista</span>
            <span class="n">puntajes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">puntaje</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">puntajes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_patrimonio_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera patrimonio total más realista&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1300</span><span class="p">)</span>
        <span class="n">patrimonios</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            <span class="n">num_propiedades</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;numero_propiedades&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            <span class="n">puntaje</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span>
            
            <span class="c1"># CÁLCULO MÁS CONSERVADOR Y REALISTA</span>
            <span class="n">anos_acumulacion</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">edad</span> <span class="o">-</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Tasa de ahorro realista según estrato</span>
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tasa_ahorro</span> <span class="o">=</span> <span class="mf">0.08</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">tasa_ahorro</span> <span class="o">=</span> <span class="mf">0.12</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tasa_ahorro</span> <span class="o">=</span> <span class="mf">0.18</span>
            
            <span class="n">patrimonio_base</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">anos_acumulacion</span> <span class="o">*</span> <span class="n">tasa_ahorro</span>
            
            <span class="c1"># Ajuste por propiedades</span>
            <span class="k">if</span> <span class="n">num_propiedades</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">valor_propiedades</span> <span class="o">=</span> <span class="n">num_propiedades</span> <span class="o">*</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># Más conservador</span>
                <span class="n">patrimonio_base</span> <span class="o">+=</span> <span class="n">valor_propiedades</span> <span class="o">*</span> <span class="mf">0.7</span>
            
            <span class="c1"># Variación natural</span>
            <span class="n">patrimonio_final</span> <span class="o">=</span> <span class="n">patrimonio_base</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
            
            <span class="c1"># Límites realistas</span>
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">patrimonio_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">patrimonio_final</span><span class="p">,</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">patrimonio_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">patrimonio_final</span><span class="p">,</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">patrimonio_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">patrimonio_final</span><span class="p">,</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">400</span><span class="p">)</span>
            
            <span class="n">patrimonio_final</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">patrimonio_final</span> <span class="o">/</span> <span class="mi">100000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span>
            <span class="n">patrimonios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patrimonio_final</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;patrimonio_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patrimonios</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_saldo_banco_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera saldo promedio en cuenta bancaria más realista&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1400</span><span class="p">)</span>
        <span class="n">saldos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            <span class="n">egresos</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span>
            <span class="n">capacidad_ahorro</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">-</span> <span class="n">egresos</span>
            
            <span class="k">if</span> <span class="n">capacidad_ahorro</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">saldos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="c1"># MESES DE AHORRO MÁS REALISTAS</span>
            <span class="k">if</span> <span class="n">capacidad_ahorro</span> <span class="o">&lt;</span> <span class="mi">500000</span><span class="p">:</span>
                <span class="n">meses_ahorro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">capacidad_ahorro</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">:</span>
                <span class="n">meses_ahorro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">meses_ahorro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
            
            <span class="n">saldo</span> <span class="o">=</span> <span class="n">capacidad_ahorro</span> <span class="o">*</span> <span class="n">meses_ahorro</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="n">saldo</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">saldo</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span>
            
            <span class="n">saldos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">saldo</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;saldo_promedio_banco&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saldos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_valor_inmueble_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera valor del inmueble con enfoque REALISTA&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1500</span><span class="p">)</span>
        <span class="n">valores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">ciudad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ciudad&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            
            <span class="c1"># DTI OBJETIVO REALISTA: 20-30%</span>
            <span class="n">dti_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">)</span>
            <span class="n">cuota_maxima</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="n">dti_target</span>
            
            <span class="c1"># PLAZOS MÁS LARGOS PARA REDUCIR CUOTAS</span>
            <span class="n">tasa_estimada</span> <span class="o">=</span> <span class="mf">0.11</span>  <span class="c1"># Tasa más realista</span>
            <span class="n">plazo_estimado</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
            
            <span class="c1"># CÁLCULO CONSERVADOR</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">tasa_estimada</span> <span class="o">/</span> <span class="mi">12</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">plazo_estimado</span> <span class="o">*</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">monto_max</span> <span class="o">=</span> <span class="n">cuota_maxima</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">monto_max</span> <span class="o">=</span> <span class="n">cuota_maxima</span> <span class="o">*</span> <span class="n">n</span>
            
            <span class="c1"># CUOTA INICIAL REALISTA (20-35%)</span>
            <span class="n">porcentaje_credito</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">)</span>
            <span class="n">valor_max_calculado</span> <span class="o">=</span> <span class="n">monto_max</span> <span class="o">/</span> <span class="n">porcentaje_credito</span>
            
            <span class="c1"># LÍMITE POR SALARIO (más realista)</span>
            <span class="n">valor_maximo_teorico</span> <span class="o">=</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># 5 años de salario</span>
            <span class="n">valor_max_real</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valor_maximo_teorico</span><span class="p">,</span> <span class="n">valor_max_calculado</span><span class="p">)</span>
            
            <span class="c1"># RANGO BASE SEGÚN CIUDAD Y ESTRATO</span>
            <span class="k">if</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valores_inmuebles</span><span class="p">:</span>
                <span class="n">rangos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valores_inmuebles</span><span class="p">[</span><span class="n">ciudad</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Cartagena&quot;</span><span class="p">,</span> <span class="s2">&quot;Bucaramanga&quot;</span><span class="p">,</span> <span class="s2">&quot;Pereira&quot;</span><span class="p">]:</span>
                <span class="n">rangos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valores_inmuebles</span><span class="p">[</span><span class="s2">&quot;intermedia&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rangos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valores_inmuebles</span><span class="p">[</span><span class="s2">&quot;pequeña&quot;</span><span class="p">]</span>
            
            <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">rangos</span><span class="p">[</span><span class="n">estrato</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># AJUSTE AL MÁXIMO QUE PUEDE PAGAR</span>
            <span class="n">max_val_ajustado</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">valor_max_real</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">min_val_ajustado</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val_ajustado</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
            
            <span class="c1"># VALOR MÍNIMO REALISTA</span>
            <span class="n">min_val_ajustado</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val_ajustado</span><span class="p">,</span> <span class="n">salario</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">max_val_ajustado</span> <span class="o">&gt;</span> <span class="n">min_val_ajustado</span><span class="p">:</span>
                <span class="n">valor_millones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_val_ajustado</span><span class="p">,</span> <span class="n">max_val_ajustado</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valor_millones</span> <span class="o">=</span> <span class="n">min_val_ajustado</span>
            
            <span class="n">valor_inmueble</span> <span class="o">=</span> <span class="n">valor_millones</span> <span class="o">*</span> <span class="mi">1000000</span>
            
            <span class="c1"># VALIDACIÓN FINAL</span>
            <span class="n">valor_inmueble</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">valor_inmueble</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000000</span>
            <span class="n">valor_inmueble</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">valor_inmueble</span><span class="p">,</span> <span class="mi">30000000</span><span class="p">)</span>  <span class="c1"># Mínimo 30 millones</span>
            
            <span class="n">valores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valor_inmueble</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;valor_inmueble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_cuota_inicial_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera cuota inicial REALISTA&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1700</span><span class="p">)</span>
        <span class="n">porcentajes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">valores_cuota</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">valor_inmueble</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;valor_inmueble&#39;</span><span class="p">]</span>
            <span class="n">saldo_banco</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;saldo_promedio_banco&#39;</span><span class="p">]</span>
            <span class="n">patrimonio</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;patrimonio_total&#39;</span><span class="p">]</span>
            <span class="n">puntaje</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span>
            
            <span class="n">liquidez_total</span> <span class="o">=</span> <span class="n">saldo_banco</span> <span class="o">+</span> <span class="p">(</span><span class="n">patrimonio</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>  <span class="c1"># Más conservador</span>
            <span class="n">liquidez_disponible</span> <span class="o">=</span> <span class="n">liquidez_total</span> <span class="o">*</span> <span class="mf">0.60</span>  <span class="c1"># Solo 60% de la liquidez</span>
            
            <span class="c1"># CUOTA INICIAL REALISTA SEGÚN PUNTAJE</span>
            <span class="k">if</span> <span class="n">puntaje</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">:</span>
                <span class="n">porcentaje_objetivo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&lt;</span> <span class="mi">750</span><span class="p">:</span>
                <span class="n">porcentaje_objetivo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">porcentaje_objetivo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
            
            <span class="c1"># AJUSTE POR CAPACIDAD</span>
            <span class="n">porcentaje_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">porcentaje_objetivo</span><span class="p">,</span> <span class="p">(</span><span class="n">liquidez_disponible</span> <span class="o">/</span> <span class="n">valor_inmueble</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">porcentaje_final</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">porcentaje_final</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Mínimo 10%</span>
            <span class="n">porcentaje_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">porcentaje_final</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>  <span class="c1"># Máximo 40%</span>
            <span class="n">porcentaje_final</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">porcentaje_final</span><span class="p">)</span>
            
            <span class="n">valor_cuota_inicial</span> <span class="o">=</span> <span class="n">valor_inmueble</span> <span class="o">*</span> <span class="p">(</span><span class="n">porcentaje_final</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            
            <span class="c1"># GARANTIZAR CUOTA INICIAL ASEQUIBLE</span>
            <span class="k">if</span> <span class="n">valor_cuota_inicial</span> <span class="o">&gt;</span> <span class="n">liquidez_disponible</span><span class="p">:</span>
                <span class="n">porcentaje_final</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">liquidez_disponible</span> <span class="o">/</span> <span class="n">valor_inmueble</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
                <span class="n">valor_cuota_inicial</span> <span class="o">=</span> <span class="n">valor_inmueble</span> <span class="o">*</span> <span class="p">(</span><span class="n">porcentaje_final</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
            
            <span class="n">porcentajes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">porcentaje_final</span><span class="p">)</span>
            <span class="n">valores_cuota</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valor_cuota_inicial</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;porcentaje_cuota_inicial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">porcentajes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;valor_cuota_inicial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valores_cuota</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_plazo_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera plazo del crédito REALISTA&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1800</span><span class="p">)</span>
        <span class="n">plazos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            
            <span class="n">plazo_maximo_edad</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">75</span> <span class="o">-</span> <span class="n">edad</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># Más flexible (75 años)</span>
            
            <span class="k">if</span> <span class="n">plazo_maximo_edad</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">plazos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="c1"># PLAZOS MÁS REALISTAS</span>
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">plazo_preferido</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="n">plazo_preferido</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">plazo_preferido</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plazo_preferido</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            
            <span class="n">plazo_final</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plazo_preferido</span><span class="p">,</span> <span class="n">plazo_maximo_edad</span><span class="p">)</span>
            <span class="n">plazo_final</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">plazo_final</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            
            <span class="n">plazos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plazo_final</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;plazo_credito&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plazos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_tasa_interes_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera tasa de interés REALISTA&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span>
        <span class="n">tasas</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">puntaje</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span>
            <span class="n">ltv</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">]</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            
            <span class="c1"># TASA BASE MÁS REALISTA</span>
            <span class="n">tasa_base</span> <span class="o">=</span> <span class="mf">10.0</span>
            
            <span class="k">if</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">750</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.8</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">650</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">550</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="mf">2.2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spread_puntaje</span> <span class="o">=</span> <span class="mf">3.5</span>
            
            <span class="k">if</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">spread_ltv</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">spread_ltv</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">85</span><span class="p">:</span>
                <span class="n">spread_ltv</span> <span class="o">=</span> <span class="mf">0.4</span>
            <span class="k">elif</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">spread_ltv</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spread_ltv</span> <span class="o">=</span> <span class="mf">1.2</span>
            
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">spread_empleo</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">:</span>
                <span class="n">spread_empleo</span> <span class="o">=</span> <span class="mf">0.3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spread_empleo</span> <span class="o">=</span> <span class="mf">0.8</span>
            
            <span class="n">tasa_final</span> <span class="o">=</span> <span class="n">tasa_base</span> <span class="o">+</span> <span class="n">spread_puntaje</span> <span class="o">+</span> <span class="n">spread_ltv</span> <span class="o">+</span> <span class="n">spread_empleo</span>
            <span class="n">tasa_final</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># Menos variación</span>
            <span class="n">tasa_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">tasa_final</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">)</span>
            <span class="n">tasa_final</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tasa_final</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="n">tasas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tasa_final</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tasa_interes_anual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tasas</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_cuota_mensual_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula cuota mensual GARANTIZANDO DTI RAZONABLE&quot;&quot;&quot;</span>
        <span class="n">cuotas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dtis</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">monto</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;monto_credito&#39;</span><span class="p">]</span>
            <span class="n">tasa_anual</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tasa_interes_anual&#39;</span><span class="p">]</span>
            <span class="n">plazo_anos</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;plazo_credito&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            
            <span class="n">i</span> <span class="o">=</span> <span class="n">tasa_anual</span> <span class="o">/</span> <span class="mi">12</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">plazo_anos</span> <span class="o">*</span> <span class="mi">12</span>
            
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cuota</span> <span class="o">=</span> <span class="n">monto</span> <span class="o">/</span> <span class="n">n</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cuota</span> <span class="o">=</span> <span class="n">monto</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="n">cuota</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cuota</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">dti</span> <span class="o">=</span> <span class="p">(</span><span class="n">cuota</span> <span class="o">/</span> <span class="n">salario</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            
            <span class="c1"># AJUSTE AUTOMÁTICO PARA GARANTIZAR DTI ≤ 35%</span>
            <span class="k">if</span> <span class="n">dti</span> <span class="o">&gt;</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">factor_ajuste</span> <span class="o">=</span> <span class="mi">35</span> <span class="o">/</span> <span class="n">dti</span>
                <span class="n">monto_ajustado</span> <span class="o">=</span> <span class="n">monto</span> <span class="o">*</span> <span class="n">factor_ajuste</span>
                <span class="n">cuota</span> <span class="o">=</span> <span class="n">monto_ajustado</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">cuota</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cuota</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">dti</span> <span class="o">=</span> <span class="p">(</span><span class="n">cuota</span> <span class="o">/</span> <span class="n">salario</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                
                <span class="c1"># ACTUALIZAR MONTO Y LTV</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;monto_credito&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">monto_ajustado</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ltv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">monto_ajustado</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;valor_inmueble&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
            
            <span class="n">cuotas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cuota</span><span class="p">)</span>
            <span class="n">dtis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cuota_mensual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cuotas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_nivel_riesgo_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula nivel de riesgo con distribución REALISTA (60% Bajo, 25% Medio, 15% Alto)&quot;&quot;&quot;</span>
        <span class="n">puntajes_riesgo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">niveles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rechazos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">puntaje</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="c1"># 1. PUNTAJE DATACRÉDITO (peso moderado)</span>
            <span class="n">pdc</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pdc</span> <span class="o">&gt;=</span> <span class="mi">800</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">25</span>
            <span class="k">elif</span> <span class="n">pdc</span> <span class="o">&gt;=</span> <span class="mi">750</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">pdc</span> <span class="o">&gt;=</span> <span class="mi">700</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="k">elif</span> <span class="n">pdc</span> <span class="o">&gt;=</span> <span class="mi">650</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">pdc</span> <span class="o">&gt;=</span> <span class="mi">600</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_pdc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_pdc</span>
            
            <span class="c1"># 2. DTI (peso importante pero no determinante)</span>
            <span class="n">dti</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dti</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">score_dti</span> <span class="o">=</span> <span class="mi">25</span>
            <span class="k">elif</span> <span class="n">dti</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">score_dti</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">dti</span> <span class="o">&lt;=</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">score_dti</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="k">elif</span> <span class="n">dti</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">:</span>
                <span class="n">score_dti</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_dti</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_dti</span>
            
            <span class="c1"># 3. CAPACIDAD RESIDUAL (crítico pero ajustado)</span>
            <span class="n">cap_residual</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cap_residual</span> <span class="o">&gt;</span> <span class="mi">500000</span><span class="p">:</span>
                <span class="n">score_cap</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="k">elif</span> <span class="n">cap_residual</span> <span class="o">&gt;</span> <span class="mi">200000</span><span class="p">:</span>
                <span class="n">score_cap</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="k">elif</span> <span class="n">cap_residual</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">:</span>
                <span class="n">score_cap</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">cap_residual</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">score_cap</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_cap</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_cap</span>
            
            <span class="c1"># 4. ESTABILIDAD LABORAL (importante)</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">score_estab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">antiguedad</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">:</span>
                <span class="n">score_estab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">antiguedad</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_estab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">antiguedad</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_estab</span>
            
            <span class="c1"># 5. GARANTÍAS/LTV</span>
            <span class="n">ltv</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="n">score_ltv</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">elif</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">score_ltv</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="k">elif</span> <span class="n">ltv</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">score_ltv</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_ltv</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_ltv</span>
            
            <span class="c1"># 6. HISTORIAL LEGAL (impacto moderado)</span>
            <span class="n">demandas</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;numero_demandas&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">demandas</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">score_legal</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">demandas</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">score_legal</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score_legal</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">puntaje</span> <span class="o">+=</span> <span class="n">score_legal</span>
            
            <span class="c1"># DISTRIBUCIÓN REALISTA (60% Bajo, 25% Medio, 15% Alto)</span>
            <span class="k">if</span> <span class="n">puntaje</span> <span class="o">&gt;=</span> <span class="mi">65</span><span class="p">:</span>  <span class="c1"># Fácil alcanzar bajo riesgo</span>
                <span class="n">nivel</span> <span class="o">=</span> <span class="s2">&quot;Bajo&quot;</span>
            <span class="k">elif</span> <span class="n">puntaje</span> <span class="o">&gt;=</span> <span class="mi">45</span><span class="p">:</span>
                <span class="n">nivel</span> <span class="o">=</span> <span class="s2">&quot;Medio&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nivel</span> <span class="o">=</span> <span class="s2">&quot;Alto&quot;</span>
            
            <span class="c1"># REGLAS DE RECHAZO MÁS FLEXIBLES</span>
            <span class="n">rechazo_automatico</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">dti</span> <span class="o">&gt;</span> <span class="mi">45</span><span class="p">:</span>  <span class="c1"># Más flexible</span>
                <span class="n">rechazo_automatico</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">ltv</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">:</span>  <span class="c1"># Más flexible</span>
                <span class="n">rechazo_automatico</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;plazo_credito&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>  <span class="c1"># Más flexible</span>
                <span class="n">rechazo_automatico</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">demandas</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">pdc</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>  <span class="c1"># Más flexible</span>
                <span class="n">rechazo_automatico</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="n">rechazo_automatico</span><span class="p">:</span>
                <span class="n">nivel</span> <span class="o">=</span> <span class="s2">&quot;Alto&quot;</span>
                <span class="n">puntaje</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">puntaje</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
            
            <span class="n">puntajes_riesgo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">puntaje</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">niveles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nivel</span><span class="p">)</span>
            <span class="n">rechazos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rechazo_automatico</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_riesgo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">puntajes_riesgo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">niveles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rechazo_automatico&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rechazos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ajustar_capacidad_residual_positiva</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GARANTIZAR QUE TODOS TENGAN CAPACIDAD RESIDUAL POSITIVA&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔧 AJUSTANDO CAPACIDAD RESIDUAL...&quot;</span><span class="p">)</span>
        <span class="n">ajustes</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">capacidad_residual</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">capacidad_residual</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ajustes</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># REDUCIR EGRESOS PARA HACER CAPACIDAD RESIDUAL POSITIVA</span>
                <span class="n">ajuste_necesario</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">capacidad_residual</span><span class="p">)</span> <span class="o">+</span> <span class="mi">50000</span>
                <span class="n">nuevo_egreso</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ajuste_necesario</span>
                
                <span class="c1"># GARANTIZAR EGRESOS MÍNIMOS REALISTAS (40% del salario)</span>
                <span class="n">egreso_minimo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.40</span>
                <span class="n">nuevo_egreso</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nuevo_egreso</span><span class="p">,</span> <span class="n">egreso_minimo</span><span class="p">)</span>
                
                <span class="c1"># ACTUALIZAR DATOS</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuevo_egreso</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;capacidad_ahorro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nuevo_egreso</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;capacidad_ahorro&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;cuota_mensual&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;ratio_egreso_salario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nuevo_egreso</span> <span class="o">/</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="k">if</span> <span class="n">ajustes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ </span><span class="si">{</span><span class="n">ajustes</span><span class="si">}</span><span class="s2"> registros ajustados para capacidad residual positiva&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Todos los registros tienen capacidad residual positiva&quot;</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># MÉTODOS ORIGINALES (MANTENIDOS CON AJUSTES MENORES)</span>
    <span class="c1"># ========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_estrato</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera estrato socioeconómico según ciudad&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">estratos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ciudad&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bogotá&quot;</span><span class="p">,</span> <span class="s2">&quot;Medellín&quot;</span><span class="p">,</span> <span class="s2">&quot;Cali&quot;</span><span class="p">,</span> <span class="s2">&quot;Barranquilla&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span><span class="p">[</span><span class="n">ciudad</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span><span class="p">[</span><span class="s2">&quot;grande&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Cartagena&quot;</span><span class="p">,</span> <span class="s2">&quot;Bucaramanga&quot;</span><span class="p">,</span> <span class="s2">&quot;Pereira&quot;</span><span class="p">]:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span><span class="p">[</span><span class="s2">&quot;intermedia&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estratos_por_ciudad</span><span class="p">[</span><span class="s2">&quot;pequeña&quot;</span><span class="p">]</span>
            
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">estratos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estrato</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estratos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_educacion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera nivel educativo según edad y estrato&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">educacion</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">niveles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Bachiller&quot;</span><span class="p">,</span> <span class="s2">&quot;Técnico&quot;</span><span class="p">,</span> <span class="s2">&quot;Profesional&quot;</span><span class="p">,</span> <span class="s2">&quot;Posgrado&quot;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])]</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])]</span>
            
            <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">nivel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">niveles</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">educacion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nivel</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_educacion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">educacion</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_estado_civil</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera estado civil según edad&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">400</span><span class="p">)</span>
        <span class="n">estados</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opciones</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Soltero&quot;</span><span class="p">,</span> <span class="s2">&quot;Casado&quot;</span><span class="p">,</span> <span class="s2">&quot;Unión Libre&quot;</span><span class="p">,</span> <span class="s2">&quot;Divorciado&quot;</span><span class="p">,</span> <span class="s2">&quot;Viudo&quot;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">edad</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">51</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
            
            <span class="n">estado</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">opciones</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">estados</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">estado</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;estado_civil&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estados</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_personas_a_cargo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera número de personas a cargo según estado civil y edad&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">500</span><span class="p">)</span>
        <span class="n">personas</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">estado</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estado_civil&#39;</span><span class="p">]</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">estado</span> <span class="o">==</span> <span class="s2">&quot;Soltero&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">estado</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Casado&quot;</span><span class="p">,</span> <span class="s2">&quot;Unión Libre&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            
            <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">personas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;personas_a_cargo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">personas</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_tipo_empleo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera tipo de empleo según ciudad, educación y estrato&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">600</span><span class="p">)</span>
        <span class="n">tipos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opciones</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Formal&quot;</span><span class="p">,</span> <span class="s2">&quot;Informal&quot;</span><span class="p">,</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">ciudad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ciudad&#39;</span><span class="p">]</span>
            <span class="n">educacion</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nivel_educacion&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bogotá&quot;</span><span class="p">,</span> <span class="s2">&quot;Medellín&quot;</span><span class="p">]:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Cali&quot;</span><span class="p">,</span> <span class="s2">&quot;Barranquilla&quot;</span><span class="p">,</span> <span class="s2">&quot;Cartagena&quot;</span><span class="p">,</span> <span class="s2">&quot;Bucaramanga&quot;</span><span class="p">]:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ciudad</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Pereira&quot;</span><span class="p">,</span> <span class="s2">&quot;Manizales&quot;</span><span class="p">,</span> <span class="s2">&quot;Cúcuta&quot;</span><span class="p">]:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Bachiller&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])]</span>
            <span class="k">elif</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Profesional&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])]</span>
            <span class="k">elif</span> <span class="n">educacion</span> <span class="o">==</span> <span class="s2">&quot;Posgrado&quot;</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])]</span>
            
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">probs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.6</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">probs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.3</span>
                <span class="n">probs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.3</span>
            
            <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">tipo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">opciones</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">tipos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tipo</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tipos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_antiguedad_laboral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera antigüedad laboral coherente con edad y tipo de empleo&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">700</span><span class="p">)</span>
        <span class="n">antiguedades</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">tipo_empleo</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span>
            
            <span class="n">max_antiguedad</span> <span class="o">=</span> <span class="n">edad</span> <span class="o">-</span> <span class="mi">18</span>
            
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="mi">15</span>
            
            <span class="k">if</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">*=</span> <span class="mf">1.4</span>
            <span class="k">elif</span> <span class="n">tipo_empleo</span> <span class="o">==</span> <span class="s2">&quot;Informal&quot;</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">*=</span> <span class="mf">0.6</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">*=</span> <span class="mf">0.9</span>
            
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">media</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="mf">0.6</span><span class="p">)</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">antiguedad</span><span class="p">,</span> <span class="n">max_antiguedad</span><span class="p">)</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">antiguedad</span><span class="p">)</span>
            <span class="n">antiguedad</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">antiguedad</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="n">antiguedades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">antiguedad</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">antiguedades</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_propiedades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera número de propiedades actuales&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1200</span><span class="p">)</span>
        <span class="n">propiedades</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">edad</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span>
            <span class="n">salario</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">5000000</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">4000000</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">8000000</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">4000000</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">salario</span> <span class="o">&lt;</span> <span class="mi">8000000</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">])]</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">m</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])]</span>
            
            <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">num_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            <span class="n">propiedades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_prop</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;numero_propiedades&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">propiedades</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_anos_inmueble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera antigüedad del inmueble&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span> <span class="o">+</span> <span class="mi">1600</span><span class="p">)</span>
        <span class="n">anos</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">estrato</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">estrato</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">estrato</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">]</span>
            
            <span class="n">tipo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;nuevo&#39;</span><span class="p">,</span> <span class="s1">&#39;semi&#39;</span><span class="p">,</span> <span class="s1">&#39;usado&#39;</span><span class="p">,</span> <span class="s1">&#39;antiguo&#39;</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="n">probs</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;nuevo&#39;</span><span class="p">:</span>
                <span class="n">ano</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;semi&#39;</span><span class="p">:</span>
                <span class="n">ano</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s1">&#39;usado&#39;</span><span class="p">:</span>
                <span class="n">ano</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ano</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            
            <span class="n">anos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anos_inmueble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anos</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_monto_credito</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula monto del crédito solicitado&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monto_credito&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;valor_inmueble&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;valor_cuota_inicial&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monto_credito&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;valor_inmueble&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generar_caracteristicas_derivadas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Genera todas las características derivadas&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_ahorro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_ahorro&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cuota_mensual&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ratio_cuota_ingreso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ratio_patrimonio_deuda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;patrimonio_total&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monto_credito&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;meses_colchon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;saldo_promedio_banco&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cuota_mensual&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ratio_cuota_ahorro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cuota_mensual&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_ahorro&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ratio_egreso_salario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score_edad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calcular_score_edad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag_sobreendeudamiento&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">35</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score_estabilidad_laboral&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_score_estabilidad</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;riesgo_legal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;numero_demandas&#39;</span><span class="p">]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;educacion_x_salario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codificar_educacion</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad_x_antiguedad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ltv_x_puntaje&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">900</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;grupo_edad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">],</span> 
                                       <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                                       <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Joven&#39;</span><span class="p">,</span> <span class="s1">&#39;Adulto Joven&#39;</span><span class="p">,</span> <span class="s1">&#39;Adulto&#39;</span><span class="p">,</span> <span class="s1">&#39;Adulto Mayor&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rango_salarial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">],</span>
                                           <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000000</span><span class="p">,</span> <span class="mi">3500000</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">,</span> <span class="mi">8000000</span><span class="p">,</span> <span class="mi">12000000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
                                           <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Muy Bajo&#39;</span><span class="p">,</span> <span class="s1">&#39;Bajo&#39;</span><span class="p">,</span> <span class="s1">&#39;Medio-Bajo&#39;</span><span class="p">,</span> <span class="s1">&#39;Medio&#39;</span><span class="p">,</span> <span class="s1">&#39;Medio-Alto&#39;</span><span class="p">,</span> <span class="s1">&#39;Alto&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;categoria_puntaje&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">],</span>
                                               <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
                                               <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Crítico&#39;</span><span class="p">,</span> <span class="s1">&#39;Muy Malo&#39;</span><span class="p">,</span> <span class="s1">&#39;Malo&#39;</span><span class="p">,</span> <span class="s1">&#39;Regular&#39;</span><span class="p">,</span> <span class="s1">&#39;Bueno&#39;</span><span class="p">,</span> <span class="s1">&#39;Muy Bueno&#39;</span><span class="p">,</span> <span class="s1">&#39;Excelente&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_ltv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">],</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Muy Bajo&#39;</span><span class="p">,</span> <span class="s1">&#39;Bajo&#39;</span><span class="p">,</span> <span class="s1">&#39;Medio&#39;</span><span class="p">,</span> <span class="s1">&#39;Alto&#39;</span><span class="p">,</span> <span class="s1">&#39;Muy Alto&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_dti&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">],</span>
                                      <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Excelente&#39;</span><span class="p">,</span> <span class="s1">&#39;Bueno&#39;</span><span class="p">,</span> <span class="s1">&#39;Aceptable&#39;</span><span class="p">,</span> <span class="s1">&#39;Límite&#39;</span><span class="p">,</span> <span class="s1">&#39;Alto&#39;</span><span class="p">,</span> <span class="s1">&#39;Crítico&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_score_edad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edad</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula score de edad&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">30</span>
        <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="n">edad</span> <span class="o">&lt;=</span> <span class="mi">55</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">40</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">edad</span> <span class="o">-</span> <span class="mi">55</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_score_estabilidad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula score de estabilidad laboral&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Formal&quot;</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">25</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tipo_empleo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Independiente&quot;</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="mi">10</span>
            
            <span class="n">score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_codificar_educacion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Codifica nivel educativo a numérico&quot;&quot;&quot;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Bachiller&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Técnico&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Profesional&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Posgrado&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_educacion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_cuota_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monto</span><span class="p">,</span> <span class="n">tasa_anual</span><span class="p">,</span> <span class="n">plazo_anos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cálculo rápido de cuota mensual&quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">tasa_anual</span> <span class="o">/</span> <span class="mi">12</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">plazo_anos</span> <span class="o">*</span> <span class="mi">12</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">monto</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">cuota</span> <span class="o">=</span> <span class="n">monto</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cuota</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># VALIDACIONES REALISTAS</span>
    <span class="c1"># ========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validar_restricciones_realistas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida que todos los registros cumplan restricciones REALISTAS&quot;&quot;&quot;</span>
        
        <span class="n">errores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Restricción 1: Salario &gt; Egresos</span>
        <span class="n">violacion_1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;egresos_mensuales&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">violacion_1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✗ </span><span class="si">{</span><span class="n">violacion_1</span><span class="si">}</span><span class="s2"> registros con Salario ≤ Egresos&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Salario &gt; Egresos en todos los registros&quot;</span><span class="p">)</span>
        
        <span class="c1"># Restricción 2: DTI ≤ 40%</span>
        <span class="n">violacion_2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">40.5</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">violacion_2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✗ </span><span class="si">{</span><span class="n">violacion_2</span><span class="si">}</span><span class="s2"> registros con DTI &gt; 40%&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ DTI ≤ 40</span><span class="si">% e</span><span class="s2">n todos los registros&quot;</span><span class="p">)</span>
        
        <span class="c1"># Restricción 3: Capacidad Residual ≥ 0 (CRÍTICA)</span>
        <span class="n">violacion_3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">violacion_3</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✗ </span><span class="si">{</span><span class="n">violacion_3</span><span class="si">}</span><span class="s2"> registros con Capacidad Residual &lt; 0&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Capacidad Residual ≥ 0 en todos los registros&quot;</span><span class="p">)</span>
        
        <span class="c1"># Restricción 4: Edad + Plazo ≤ 80 (más flexible)</span>
        <span class="n">violacion_4</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;plazo_credito&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">violacion_4</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✗ </span><span class="si">{</span><span class="n">violacion_4</span><span class="si">}</span><span class="s2"> registros con Edad + Plazo &gt; 80&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Edad + Plazo ≤ 80 en todos los registros&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">errores</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ ADVERTENCIAS:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errores</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ Se recomienda revisar estos registros&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✓✓✓ Todas las restricciones duras se cumplen&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validando correlaciones REALISTAS...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validar_correlaciones_realistas</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validando distribución REALISTA de riesgo...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validar_distribucion_riesgo_realista</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validar_correlaciones_realistas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida correlaciones REALISTAS&quot;&quot;&quot;</span>
        
        <span class="n">correlaciones</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">,</span> <span class="s1">&#39;antiguedad_empleo&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">,</span> <span class="s1">&#39;nivel_educacion_cod&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">,</span> <span class="s1">&#39;estrato_socioeconomico&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">),</span>  <span class="c1"># Más suave</span>
            <span class="p">(</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">,</span> <span class="s1">&#39;numero_demandas&#39;</span><span class="p">):</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.30</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">),</span>   <span class="c1"># Mucho más suave</span>
            <span class="p">(</span><span class="s1">&#39;dti&#39;</span><span class="p">,</span> <span class="s1">&#39;nivel_riesgo_cod&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">),</span>                    <span class="c1"># Moderada</span>
            <span class="p">(</span><span class="s1">&#39;edad&#39;</span><span class="p">,</span> <span class="s1">&#39;patrimonio_total&#39;</span><span class="p">):</span> <span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>                    <span class="c1"># Moderada</span>
        <span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_educacion_cod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codificar_educacion</span><span class="p">()</span>
        <span class="n">nivel_riesgo_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Bajo&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Medio&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Alto&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo_cod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">nivel_riesgo_map</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">),</span> <span class="p">(</span><span class="n">min_corr</span><span class="p">,</span> <span class="n">max_corr</span><span class="p">,</span> <span class="n">signo</span><span class="p">)</span> <span class="ow">in</span> <span class="n">correlaciones</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">var1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">var2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">var1</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">var2</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="n">signo</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">min_corr</span> <span class="o">&lt;=</span> <span class="n">corr</span> <span class="o">&lt;=</span> <span class="n">max_corr</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> ↔ </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2">: r=</span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (dentro de rango realista)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ⚠ </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> ↔ </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2">: r=</span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (fuera de rango esperado)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">max_corr</span> <span class="o">&lt;=</span> <span class="n">corr</span> <span class="o">&lt;=</span> <span class="n">min_corr</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ✓ </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> ↔ </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2">: r=</span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (dentro de rango realista)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ⚠ </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> ↔ </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2">: r=</span><span class="si">{</span><span class="n">corr</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (fuera de rango esperado)&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;nivel_educacion_cod&#39;</span><span class="p">,</span> <span class="s1">&#39;nivel_riesgo_cod&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validar_distribucion_riesgo_realista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida la distribución REALISTA del nivel de riesgo&quot;&quot;&quot;</span>
        
        <span class="n">conteo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Bajo:  </span><span class="si">{</span><span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Bajo&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (objetivo: 55-65%)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Medio: </span><span class="si">{</span><span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Medio&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (objetivo: 20-30%)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Alto:  </span><span class="si">{</span><span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Alto&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% (objetivo: 10-20%)&quot;</span><span class="p">)</span>
        
        <span class="n">bajo</span> <span class="o">=</span> <span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Bajo&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">medio</span> <span class="o">=</span> <span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Medio&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">alto</span> <span class="o">=</span> <span class="n">conteo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Alto&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="mi">55</span> <span class="o">&lt;=</span> <span class="n">bajo</span> <span class="o">&lt;=</span> <span class="mi">65</span> <span class="ow">and</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">medio</span> <span class="o">&lt;=</span> <span class="mi">30</span> <span class="ow">and</span> <span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">alto</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ✓ Distribución REALISTA alcanzada&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ⚠ Distribución fuera de rangos objetivo&quot;</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># MÉTODOS DE EXPORTACIÓN</span>
    <span class="c1"># ========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exportar_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;datos_credito_hipotecario_realista.csv&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exporta el dataset a CSV&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✓ Archivo exportado: </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Tamaño: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> registros × </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> columnas&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exportar_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nombre_archivo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;metadata_generacion_realista.json&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exporta metadata de la generación&quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fecha_generacion&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
            <span class="s2">&quot;numero_registros&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">),</span>
            <span class="s2">&quot;semilla_aleatoria&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">semilla_base</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.3 - REALISTA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;distribucion_objetivo&quot;</span><span class="p">:</span> <span class="s2">&quot;60% Bajo, 25% Medio, 15% Alto&quot;</span><span class="p">,</span>
            <span class="s2">&quot;columnas&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;distribucion_riesgo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;estadisticas_clave&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;salario_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                <span class="s2">&quot;edad_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                <span class="s2">&quot;puntaje_datacredito_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                <span class="s2">&quot;dti_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                <span class="s2">&quot;ltv_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ltv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
                <span class="s2">&quot;capacidad_residual_promedio&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nombre_archivo</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Metadata exportada: </span><span class="si">{</span><span class="n">nombre_archivo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">obtener_muestra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene una muestra aleatoria del dataset&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">obtener_resumen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene resumen completo del dataset generado&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total_registros&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">),</span>
            <span class="s2">&quot;columnas&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
            <span class="s2">&quot;distribucion_riesgo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;rechazos_automaticos&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rechazo_automatico&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="s2">&quot;estadisticas&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;edad&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s2">&quot;mediana&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;edad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;salario&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s2">&quot;mediana&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;salario_mensual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;puntaje_datacredito&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s2">&quot;mediana&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;dti&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s2">&quot;mediana&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dti&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="s2">&quot;capacidad_residual&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;media&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                    <span class="s2">&quot;mediana&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>


<span class="c1"># ============================================================================</span>
<span class="c1"># FUNCIÓN PRINCIPAL PARA EJECUTAR</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="generar_datos_credito_realista">
<a class="viewcode-back" href="../api_reference.html#generar_datos.generar_datos_credito_realista">[documentos]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generar_datos_credito_realista</span><span class="p">(</span><span class="n">n_registros</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">semilla</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
                                  <span class="n">exportar_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                  <span class="n">exportar_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Función principal para generar datos de crédito hipotecario REALISTAS</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        n_registros: Número de registros a generar (default: 10000)</span>
<span class="sd">        semilla: Semilla aleatoria para reproducibilidad (default: 42)</span>
<span class="sd">        exportar_csv: Si True, exporta a CSV (default: True)</span>
<span class="sd">        exportar_metadata: Si True, exporta metadata JSON (default: True)</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame con los datos generados</span>

<span class="sd">    Ejemplo de uso:</span>
<span class="sd">        &gt;&gt;&gt; df = generar_datos_credito_realista(n_registros=5000, semilla=42)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">generador</span> <span class="o">=</span> <span class="n">GeneradorCreditoHipotecarioRealista</span><span class="p">(</span><span class="n">n_registros</span><span class="o">=</span><span class="n">n_registros</span><span class="p">,</span> <span class="n">semilla</span><span class="o">=</span><span class="n">semilla</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">generador</span><span class="o">.</span><span class="n">generar</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">exportar_csv</span><span class="p">:</span>
        <span class="n">generador</span><span class="o">.</span><span class="n">exportar_csv</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">exportar_metadata</span><span class="p">:</span>
        <span class="n">generador</span><span class="o">.</span><span class="n">exportar_metadata</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESUMEN DE DATOS GENERADOS - VERSIÓN REALISTA&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

    <span class="n">resumen</span> <span class="o">=</span> <span class="n">generador</span><span class="o">.</span><span class="n">obtener_resumen</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total de registros: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;total_registros&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total de columnas: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;columnas&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Distribución REALISTA de Nivel de Riesgo:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nivel</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;distribucion_riesgo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">porcentaje</span> <span class="o">=</span> <span class="p">(</span><span class="n">cantidad</span> <span class="o">/</span> <span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;total_registros&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">nivel</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cantidad</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">porcentaje</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rechazos automáticos: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;rechazos_automaticos&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Estadísticas Clave REALISTAS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Edad promedio: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;estadisticas&#39;</span><span class="p">][</span><span class="s1">&#39;edad&#39;</span><span class="p">][</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> años&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Salario promedio: $</span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;estadisticas&#39;</span><span class="p">][</span><span class="s1">&#39;salario&#39;</span><span class="p">][</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2"> COP&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Puntaje DataCrédito promedio: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;estadisticas&#39;</span><span class="p">][</span><span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">][</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  DTI promedio: </span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;estadisticas&#39;</span><span class="p">][</span><span class="s1">&#39;dti&#39;</span><span class="p">][</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Capacidad residual promedio: $</span><span class="si">{</span><span class="n">resumen</span><span class="p">[</span><span class="s1">&#39;estadisticas&#39;</span><span class="p">][</span><span class="s1">&#39;capacidad_residual&#39;</span><span class="p">][</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2"> COP&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓✓✓ PROCESO COMPLETADO EXITOSAMENTE - VERSIÓN REALISTA&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># EJECUCIÓN PRINCIPAL</span>
<span class="c1"># ============================================================================</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ejecutar este bloque para generar los datos REALISTAS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">╔══════════════════════════════════════════════════════════════════════╗</span>
<span class="s2">║                                                                      ║</span>
<span class="s2">║   GENERADOR DE DATOS SINTÉTICOS DE CRÉDITO HIPOTECARIO - COLOMBIA   ║</span>
<span class="s2">║                      Versión 1.3 - REALISTA                         ║</span>
<span class="s2">║                                                                      ║</span>
<span class="s2">╚══════════════════════════════════════════════════════════════════════╝</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># CONFIGURACIÓN REALISTA</span>
    <span class="n">N_REGISTROS</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">SEMILLA</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="c1"># GENERAR DATOS REALISTAS</span>
    <span class="n">df_credito</span> <span class="o">=</span> <span class="n">generar_datos_credito_realista</span><span class="p">(</span>
        <span class="n">n_registros</span><span class="o">=</span><span class="n">N_REGISTROS</span><span class="p">,</span>
        <span class="n">semilla</span><span class="o">=</span><span class="n">SEMILLA</span><span class="p">,</span>
        <span class="n">exportar_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exportar_metadata</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># MOSTRAR MUESTRA DE DATOS</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📊 MUESTRA DE LOS DATOS GENERADOS (5 registros aleatorios):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="n">muestra</span> <span class="o">=</span> <span class="n">df_credito</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)[[</span><span class="s1">&#39;edad&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span><span class="p">,</span> <span class="s1">&#39;salario_mensual&#39;</span><span class="p">,</span> <span class="s1">&#39;puntaje_datacredito&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;valor_inmueble&#39;</span><span class="p">,</span> <span class="s1">&#39;dti&#39;</span><span class="p">,</span> <span class="s1">&#39;capacidad_residual&#39;</span><span class="p">,</span> <span class="s1">&#39;nivel_riesgo&#39;</span><span class="p">]]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">muestra</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📋 COLUMNAS DISPONIBLES:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_credito</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">2d</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">💾 Datos disponibles en la variable: df_credito&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💾 Archivo CSV guardado: datos_credito_hipotecario_realista.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;💾 Metadata guardada: metadata_generacion_realista.json&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MEJORAS REALISTAS IMPLEMENTADAS:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Distribución REALISTA: 60% Bajo, 25% Medio, 15% Alto&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Correlaciones suaves y creíbles&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ 100</span><span class="si">% c</span><span class="s2">apacidad residual positiva&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Impacto realista de demandas en puntaje&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Salarios y valores de inmuebles realistas&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ DTI máximo 35</span><span class="si">% g</span><span class="s2">arantizado&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Rechazos automáticos &lt;5%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2024, Andrés Fernando Gómez Rojas.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>